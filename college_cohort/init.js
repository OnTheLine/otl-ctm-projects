var data = {
    "Weaver": {
        "Start": {
            "Starting Class": 190,
        },
        "2008": {
            "New to College": 95,
            "Not in NSC": 95
        },
        "2009": {
            "Total Obtained Degree": 1,
            "Retained": 72,
            "No Longer Enrolled": 22,
            "New to College": 9,
            "Returned After Stop Out": 0,
            "In College": 81,
            "No Longer Enrolled/Not in NSC": 108,
            "2010 Obtained Degree": 1
        },
        "2010": {
            "Retained": 55,
            "No Longer Enrolled": 25,
            "New to College": 5,
            "Returned After Stop Out": 3,
            "Total Obtained Degree": 2,
            "In College": 63,
            "No Longer Enrolled/Not in NSC": 125
        },
        "2011": {
            "Obtained Degree": 10,
            "Retained": 41,
            "No Longer Enrolled": 12,
            "New to College": 5,
            "Returned After Stop Out": 10,
            "Total Obtained Degree": 12,
            "In College": 56,
            "No Longer Enrolled/Not in NSC": 122
        },
        "2012": {
            "Obtained Degree": 14,
            "Retained": 19,
            "No Longer Enrolled": 23,
            "New to College": 4,
            "Returned After Stop Out": 4,
            "Total Obtained Degree": 26,
            "In College": 27,
            "No Longer Enrolled/Not in NSC": 137
        },
        "2013": {
            "Obtained Degree": 4,
            "Retained": 14,
            "No Longer Enrolled": 9,
            "New to College": 1,
            "Returned After Stop Out": 8,
            "Total Obtained Degree": 30,
            "In College": 23,
            "No Longer Enrolled/Not in NSC": 137,
            "Started Class": 190
        },
        "Obtained Degree": 30,
        "Obtained Degree Percent": "15.80%",
        "Still Enrolled": 23,
        "Still Enrolled Percent": "12.10%",
        "Never in NSC": 70,
        "Never in NSC Percent": "36.80%",
        "No Longer Enrolled and Not Graduated": 67,
        "No Longer Enrolled and Not Graduated Percent": "35.30%"
    },
    "Classical": {
        "Start": {
            "Starting Class": 48,
        },
        "2008": {
            "New to College": 37,
            "Not in NSC": 11
        },
        "2009": {
            "Total Obtained Degree": 1,
            "Retained": 28,
            "No Longer Enrolled": 8,
            "New to College": 3,
            "Returned After Stop Out": 0,
            "In College": 31,
            "No Longer Enrolled/Not in NSC": 16,
            "2010 Obtained Degree": 1
        },
        "2010": {
            "Retained": 24,
            "No Longer Enrolled": 6,
            "New to College": 0,
            "Returned After Stop Out": 3,
            "Total Obtained Degree": 2,
            "In College": 27,
            "No Longer Enrolled/Not in NSC": 19
        },
        "2011": {
            "Obtained Degree": 9,
            "Retained": 16,
            "No Longer Enrolled": 2,
            "New to College": 1,
            "Returned After Stop Out": 0,
            "Total Obtained Degree": 11,
            "In College": 17,
            "No Longer Enrolled/Not in NSC": 20
        },
        "2012": {
            "Obtained Degree": 7,
            "Retained": 7,
            "No Longer Enrolled": 3,
            "New to College": 2,
            "Returned After Stop Out": 2,
            "Total Obtained Degree": 18,
            "In College": 11,
            "No Longer Enrolled/Not in NSC": 19
        },
        "2013": {
            "Obtained Degree": 3,
            "Retained": 4,
            "No Longer Enrolled": 4,
            "New to College": 0,
            "Returned After Stop Out": 3,
            "Total Obtained Degree": 21,
            "In College": 7,
            "No Longer Enrolled/Not in NSC": 20,
            "Started Class": 48
        },
        "Obtained Degree": 21,
        "Obtained Degree Percent": "43.80%",
        "Still Enrolled": 7,
        "Still Enrolled Percent": "14.60%",
        "Never in NSC": 5,
        "Never in NSC Percent": "10.40%",
        "No Longer Enrolled and Not Graduated": 15,
        "No Longer Enrolled and Not Graduated Percent": "31.30%"
    },
    "Bulkeley": {
        "Start": {
            "Starting Class": 231,
        },
        "2008": {
            "New to College": 95,
            "Not in NSC": 136
        },
        "2009": {
            "Total Obtained Degree": 2,
            "Retained": 67,
            "No Longer Enrolled": 26,
            "New to College": 16,
            "Returned After Stop Out": 0,
            "In College": 83,
            "No Longer Enrolled/Not in NSC": 146,
            "2010 Obtained Degree": 4
        },
        "2010": {
            "Retained": 67,
            "No Longer Enrolled": 12,
            "New to College": 6,
            "Returned After Stop Out": 8,
            "Total Obtained Degree": 6,
            "In College": 81,
            "No Longer Enrolled/Not in NSC": 144
        },
        "2011": {
            "Obtained Degree": 17,
            "Retained": 52,
            "No Longer Enrolled": 12,
            "New to College": 7,
            "Returned After Stop Out": 4,
            "Total Obtained Degree": 23,
            "In College": 63,
            "No Longer Enrolled/Not in NSC": 145
        },
        "2012": {
            "Obtained Degree": 13,
            "Retained": 32,
            "No Longer Enrolled": 18,
            "New to College": 2,
            "Returned After Stop Out": 7,
            "Total Obtained Degree": 36,
            "In College": 41,
            "No Longer Enrolled/Not in NSC": 154
        },
        "2013": {
            "Obtained Degree": 4,
            "Retained": 22,
            "No Longer Enrolled": 15,
            "New to College": 2,
            "Returned After Stop Out": 7,
            "Total Obtained Degree": 40,
            "In College": 31,
            "No Longer Enrolled/Not in NSC": 160,
            "Started Class": 231
        },
        "Obtained Degree": 40,
        "Obtained Degree Percent": "17.30%",
        "Still Enrolled": 31,
        "Still Enrolled Percent": "13.40%",
        "Never in NSC": 101,
        "Never in NSC Percent": "43.70%",
        "No Longer Enrolled and Not Graduated": 59,
        "No Longer Enrolled and Not Graduated Percent": "25.50%"
    },
    "Sports and Med": {
        "Start": {
            "Starting Class": 82,
        },
        "2008": {
            "New to College": 67,
            "Not in NSC": 15
        },
        "2009": {
            "Total Obtained Degree": 2,
            "Retained": 57,
            "No Longer Enrolled": 8,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "In College": 57,
            "No Longer Enrolled/Not in NSC": 23,
            "2010 Obtained Degree": 0
        },
        "2010": {
            "Retained": 51,
            "No Longer Enrolled": 6,
            "New to College": 1,
            "Returned After Stop Out": 1,
            "Total Obtained Degree": 2,
            "In College": 53,
            "No Longer Enrolled/Not in NSC": 27
        },
        "2011": {
            "Obtained Degree": 11,
            "Retained": 32,
            "No Longer Enrolled": 10,
            "New to College": 1,
            "Returned After Stop Out": 2,
            "Total Obtained Degree": 13,
            "In College": 35,
            "No Longer Enrolled/Not in NSC": 34
        },
        "2012": {
            "Obtained Degree": 10,
            "Retained": 16,
            "No Longer Enrolled": 9,
            "New to College": 1,
            "Returned After Stop Out": 3,
            "Total Obtained Degree": 23,
            "In College": 20,
            "No Longer Enrolled/Not in NSC": 39
        },
        "2013": {
            "Obtained Degree": 3,
            "Retained": 11,
            "No Longer Enrolled": 6,
            "New to College": 0,
            "Returned After Stop Out": 3,
            "Total Obtained Degree": 26,
            "In College": 14,
            "No Longer Enrolled/Not in NSC": 42,
            "Started Class": 82
        },
        "Obtained Degree": 26,
        "Obtained Degree Percent": "31.70%",
        "Still Enrolled": 14,
        "Still Enrolled Percent": "17.10%",
        "Never in NSC": 12,
        "Never in NSC Percent": "14.60%",
        "No Longer Enrolled and Not Graduated": 30,
        "No Longer Enrolled and Not Graduated Percent": "36.60%"
    },
    "Pathways": {
        "Start": {
            "Starting Class": 39,
        },
        "2008": {
            "New to College": 25,
            "Not in NSC": 14
        },
        "2009": {
            "Total Obtained Degree": 0,
            "Retained": 19,
            "No Longer Enrolled": 8,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "In College": 19,
            "No Longer Enrolled/Not in NSC": 20,
            "2010 Obtained Degree": 4
        },
        "2010": {
            "Retained": 12,
            "No Longer Enrolled": 3,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "Total Obtained Degree": 4,
            "In College": 12,
            "No Longer Enrolled/Not in NSC": 23
        },
        "2011": {
            "Obtained Degree": 5,
            "Retained": 6,
            "No Longer Enrolled": 1,
            "New to College": 1,
            "Returned After Stop Out": 1,
            "Total Obtained Degree": 9,
            "In College": 8,
            "No Longer Enrolled/Not in NSC": 22
        },
        "2012": {
            "Obtained Degree": 2,
            "Retained": 0,
            "No Longer Enrolled": 6,
            "New to College": 0,
            "Returned After Stop Out": 1,
            "Total Obtained Degree": 11,
            "In College": 1,
            "No Longer Enrolled/Not in NSC": 27
        },
        "2013": {
            "Obtained Degree": 0,
            "Retained": 1,
            "No Longer Enrolled": 0,
            "New to College": 1,
            "Returned After Stop Out": 2,
            "Total Obtained Degree": 11,
            "In College": 4,
            "No Longer Enrolled/Not in NSC": 24,
            "Started Class": 39
        },
        "Obtained Degree": 11,
        "Obtained Degree Percent": "28.20%",
        "Still Enrolled": 4,
        "Still Enrolled Percent": "10.30%",
        "Never in NSC": 11,
        "Never in NSC Percent": "28.20%",
        "No Longer Enrolled and Not Graduated": 13,
        "No Longer Enrolled and Not Graduated Percent": "33.30%"
    },
    "Capital": {
        "Start": {
            "Starting Class": 10,
        },
        "2008": {
            "New to College": 9,
            "Not in NSC": 1
        },
        "2009": {
            "Total Obtained Degree": 0,
            "Retained": 9,
            "No Longer Enrolled": 0,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "In College": 9,
            "No Longer Enrolled/Not in NSC": 1,
            "2010 Obtained Degree": 0
        },
        "2010": {
            "Retained": 7,
            "No Longer Enrolled": 2,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "Total Obtained Degree": 0,
            "In College": 7,
            "No Longer Enrolled/Not in NSC": 3
        },
        "2011": {
            "Obtained Degree": 2,
            "Retained": 5,
            "No Longer Enrolled": 0,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "Total Obtained Degree": 2,
            "In College": 5,
            "No Longer Enrolled/Not in NSC": 3
        },
        "2012": {
            "Obtained Degree": 3,
            "Retained": 2,
            "No Longer Enrolled": 0,
            "New to College": 0,
            "Returned After Stop Out": 0,
            "Total Obtained Degree": 5,
            "In College": 2,
            "No Longer Enrolled/Not in NSC": 3
        },
        "2013": {
            "Obtained Degree": 2,
            "Retained": 0,
            "No Longer Enrolled": 0,
            "New to College": 0,
            "Returned After Stop Out": 1,
            "Total Obtained Degree": 7,
            "In College": 1,
            "No Longer Enrolled/Not in NSC": 2,
            "Started Class": 10
        },
        "Obtained Degree": 7,
        "Obtained Degree Percent": "70%",
        "Still Enrolled": 1,
        "Still Enrolled Percent": "10%",
        "Never in NSC": 1,
        "Never in NSC Percent": "10%",
        "No Longer Enrolled and Not Graduated": 1,
        "No Longer Enrolled and Not Graduated Percent": "10.00%"
    },
    "District": {
        "Start": {
            "Starting Class": 600,
        },
        "2008": {
            "New to College": 328,
            "Not in NSC": 272
        },
        "2009": {
            "Total Obtained Degree": 6,
            "Retained": 252,
            "No Longer Enrolled": 72,
            "New to College": 28,
            "Returned After Stop Out": 0,
            "In College": 280,
            "No Longer Enrolled/Not in NSC": 314,
            "2010 Obtained Degree": 10
        },
        "2010": {
            "Retained": 216,
            "No Longer Enrolled": 54,
            "New to College": 12,
            "Returned After Stop Out": 15,
            "Total Obtained Degree": 16,
            "In College": 243,
            "No Longer Enrolled/Not in NSC": 341
        },
        "2011": {
            "Obtained Degree": 54,
            "Retained": 152,
            "No Longer Enrolled": 37,
            "New to College": 15,
            "Returned After Stop Out": 17,
            "Total Obtained Degree": 70,
            "In College": 184,
            "No Longer Enrolled/Not in NSC": 346
        },
        "2012": {
            "Obtained Degree": 49,
            "Retained": 76,
            "No Longer Enrolled": 59,
            "New to College": 9,
            "Returned After Stop Out": 17,
            "Total Obtained Degree": 119,
            "In College": 102,
            "No Longer Enrolled/Not in NSC": 379
        },
        "2013": {
            "Obtained Degree": 16,
            "Retained": 52,
            "No Longer Enrolled": 34,
            "New to College": 4,
            "Returned After Stop Out": 24,
            "Total Obtained Degree": 135,
            "In College": 80,
            "No Longer Enrolled/Not in NSC": 385,
            "Started Class": 600
        },
        "Obtained Degree": 135,
        "Obtained Degree Percent": "22.50%",
        "Still Enrolled": 80,
        "Still Enrolled Percent": "13.30%",
        "Never in NSC": 200,
        "Never in NSC Percent": "33.30%",
        "No Longer Enrolled and Not Graduated": 185,
        "No Longer Enrolled and Not Graduated Percent": "30.80%"
    },
    "Magnet": {
        "Start": {
            "Starting Class": 179,
        },
        "2008": {
            "New to College": 138,
            "Not in NSC": 41
        },
        "2009": {
            "Total Obtained Degree": 3,
            "Retained": 113,
            "No Longer Enrolled": 24,
            "New to College": 3,
            "Returned After Stop Out": 0,
            "In College": 116,
            "No Longer Enrolled/Not in NSC": 60,
            "2010 Obtained Degree": 5
        },
        "2010": {
            "Retained": 94,
            "No Longer Enrolled": 17,
            "New to College": 1,
            "Returned After Stop Out": 4,
            "Total Obtained Degree": 8,
            "In College": 99,
            "No Longer Enrolled/Not in NSC": 72
        },
        "2011": {
            "Obtained Degree": 27,
            "Retained": 59,
            "No Longer Enrolled": 13,
            "New to College": 3,
            "Returned After Stop Out": 3,
            "Total Obtained Degree": 35,
            "In College": 65,
            "No Longer Enrolled/Not in NSC": 79
        },
        "2012": {
            "Obtained Degree": 22,
            "Retained": 25,
            "No Longer Enrolled": 18,
            "New to College": 3,
            "Returned After Stop Out": 6,
            "Total Obtained Degree": 57,
            "In College": 34,
            "No Longer Enrolled/Not in NSC": 88
        },
        "2013": {
            "Obtained Degree": 8,
            "Retained": 16,
            "No Longer Enrolled": 10,
            "New to College": 1,
            "Returned After Stop Out": 9,
            "Total Obtained Degree": 65,
            "In College": 26,
            "No Longer Enrolled/Not in NSC": 88,
            "Started Class": 179
        },
        "Obtained Degree": 65,
        "Obtained Degree Percent": "36.30%",
        "Still Enrolled": 26,
        "Still Enrolled Percent": "14.50%",
        "Never in NSC": 29,
        "Never in NSC Percent": "16.20%",
        "No Longer Enrolled and Not Graduated": 59,
        "No Longer Enrolled and Not Graduated Percent": "33.00%"
    },
    "Neighborhood": {
        "Start": {
            "Starting Class": 421,
        },
        "2008": {
            "New to College": 190,
            "Not in NSC": 231
        },
        "2009": {
            "Total Obtained Degree": 3,
            "Retained": 139,
            "No Longer Enrolled": 48,
            "New to College": 25,
            "Returned After Stop Out": 0,
            "In College": 164,
            "No Longer Enrolled/Not in NSC": 254,
            "2010 Obtained Degree": 5
        },
        "2010": {
            "Retained": 122,
            "No Longer Enrolled": 37,
            "New to College": 11,
            "Returned After Stop Out": 11,
            "Total Obtained Degree": 8,
            "In College": 144,
            "No Longer Enrolled/Not in NSC": 269
        },
        "2011": {
            "Obtained Degree": 27,
            "Retained": 93,
            "No Longer Enrolled": 24,
            "New to College": 12,
            "Returned After Stop Out": 14,
            "Total Obtained Degree": 35,
            "In College": 119,
            "No Longer Enrolled/Not in NSC": 267
        },
        "2012": {
            "Obtained Degree": 27,
            "Retained": 51,
            "No Longer Enrolled": 41,
            "New to College": 6,
            "Returned After Stop Out": 11,
            "Total Obtained Degree": 62,
            "In College": 68,
            "No Longer Enrolled/Not in NSC": 291
        },
        "2013": {
            "Obtained Degree": 8,
            "Retained": 36,
            "No Longer Enrolled": 24,
            "New to College": 3,
            "Returned After Stop Out": 15,
            "Total Obtained Degree": 70,
            "In College": 54,
            "No Longer Enrolled/Not in NSC": 297,
            "Started Class": 421
        },
        "Obtained Degree": 70,
        "Obtained Degree Percent": "16.60%",
        "Still Enrolled": 54,
        "Still Enrolled Percent": "12.80%",
        "Never in NSC": 171,
        "Never in NSC Percent": "40.60%",
        "No Longer Enrolled and Not Graduated": 126,
        "No Longer Enrolled and Not Graduated Percent": "29.90%"
    }
};

jQuery(function($) {
    if (is_touch_device() && window.location.href.indexOf("trendct.org") != -1) {
        $(".scripter").after('<link rel=StyleSheet href="http://projects.ctmirror.org/content/trend/2015/4/college_cohort/style.css" type="text/css"><p><a class="toGraphic" href="http://projects.ctmirror.org/content/trend/2015/4/college_cohort/">Tap to view graphic</a>');
    } else {
        $(".scripter").after('<link rel=StyleSheet href="http://projects.ctmirror.org/content/trend/2015/4/college_cohort/style.css" type="text/css"><link rel=StyleSheet href="http://projects.ctmirror.org/libs/universal.css" type="text/css"><div class="interactiveContainer hero span12">        <div class="kicker pullkick selector">Select a school</div>        <select class="pulldown selector"></select>        <div class="outsideContainer">            <div class="yearContainer"></div>            <div class="chartContainer">            </div>        </div>        <div class="smallByline">Interactive by Alvin Chang; Rob Steller extracted the data from the State Department of Education website</div>    </div>');
    }


    var years = ["Start", "2008", "2009", "2010", "2011", "2012", "2013"];
    var cats = {
        "Starting Class": {
            "position": "college"
        },
        "Total Obtained Degree": {
            "position": "college"
        },
        "New to College": {
            "position": "college"
        },
        "Returned After Stop Out": {
            "position": "college"
        },
        "Retained": {
            "position": "college"
        },
        "Not in NSC": {
            "position": "non"
        },
        "No Longer Enrolled": {
            "position": "non"
        },
        "No Longer Enrolled/Not in NSC": {
            "position": "non"
        }
    }
    var explainWord = [
        "190 students graduated from Weaver High School in 2008",
        "95 went to college; 95 did not",
        "In 2009, 81 were in college, including nine new to college; 22 dropped out.",
        "In 2010, 63 were in college, including five new to college and three returning to college.",
        "In 2011, 12 students graduated; 56 were in college.",
        "In 2012, 26 students graduated, 27 students were in college and 137 were not in college.",
        "Seven years after high school, 30 of the 190 student had degrees.",
        "Click 'next' and explore other schools with the pulldown above.",
        "Explore other schools with the pulldown above."
    ];
    var stage = 0;
    var catObj = Object.keys(cats);
    var school = Object.keys(data)[0];
    makePulldown();
    makeYear(school);

    $(".pulldown").change(function() {
        school = $(this).val();
        makeYear();
        $(".yearItem").addClass("added");
    });
    $(".next").click(function() {
        stage++;
        $(".insideExplainWord").html(explainWord[stage]);
        if (stage == 8) {
            $(".next").slideUp(400);
            $(".selector").fadeIn(200);
            $(".insideExplainWord").html("At " + school + ", " + Math.round(data[school][years[years.length - 1]]["Total Obtained Degree"] / data[school][years[0]]["Starting Class"] * 100) + "% of high school seniors graduated college with seven years.");
        }
        var leftAmount = $(".yearItem.stageItem" + stage).attr("lefter");
        $(".insideExplain").css("left", Number(leftAmount) + 190 + "px");
        $(".stageItem" + (stage + 1)).css("left", leftAmount + "px");
        $(".stageItem" + stage).fadeIn(200).css("left", leftAmount + "px").addClass("added");
        $(".outsideContainer").animate({
            scrollLeft: Number(leftAmount)
        }, 1000);
    });

    function makePulldown() {
        for (i in Object.keys(data)) {
            $(".pulldown").append("<option>" + Object.keys(data)[i] + "</option>");
        }
    }

    function makeYear() {
        var c = data[school];
        if (stage > 2) {
            $(".chartContainer").empty().html('<div class="insideExplain"><div class="insideExplainWord"></div></div>');
            $(".insideExplain").css("left", 190 * 7)
        } else {
            $(".chartContainer").empty().html('<div class="insideExplain"><div class="insideExplainWord">' + explainWord[stage] + '</div><div class="next">Next</div></div>');
        }

        var counter = 0;
        for (i in years) {
            var block = $("<div class='yearItem stageItem" + counter + " year" + years[i] + "'><div class='yearHeader'>" + years[i] + "</div><div class='collegeBox rowItem'></div><div class='non rowItem'></div></div>");
            if (stage > 2) {
                block.css("left", counter * 190).fadeIn(200);
            } else {
                block.css("left", 0).attr("lefter", counter * 190);
            }

            $(".chartContainer").append(block);
            makeBox(c[years[i]], years[i]);
            counter++;
        }
        $(".insideExplainWord").html("At " + school + ", " + Math.round(data[school][years[years.length - 1]]["Total Obtained Degree"] / data[school][years[0]]["Starting Class"] * 100) + "% of high school seniors graduated college with seven years.");
    }

    function makeBox(d, year) {
        for (i in catObj) {
            if (d[catObj[i]] != undefined && d[catObj[i]] != 0) {
                var box;
                if (catObj[i] == "No Longer Enrolled/Not in NSC") {
                    box = $("<div class='boxItem'><div class='boxWord'>Not enrolled (" + (d[catObj[i]] - d["No Longer Enrolled"]) + ")</div></div>").css("height", d[catObj[i]] / data[school]["Start"]["Starting Class"] * 100 + "%");
                } else if (catObj[i] == "No Longer Enrolled") {
                    box = $("<div class='boxItem'><div class='boxWord'>Dropped out (" + d[catObj[i]] + ")</div></div>").css("height", d[catObj[i]] / data[school]["Start"]["Starting Class"] * 100 + "%");
                } else if (catObj[i] == "Not in NSC") {
                    box = $("<div class='boxItem'><div class='boxWord'>Not enrolled (" + d[catObj[i]] + ")</div></div>").css("height", d[catObj[i]] / data[school]["Start"]["Starting Class"] * 100 + "%");
                } else {
                    box = $("<div class='boxItem'><div class='boxWord'>" + catObj[i] + " (" + d[catObj[i]] + ")</div></div>").css("height", d[catObj[i]] / data[school]["Start"]["Starting Class"] * 100 + "%");
                }
                box.addClass(catObj[i].split(" ").join("")).addClass(cats[catObj[i]].position);
                //$(".year" + year + " ." + cats[catObj[i]].position).append(box);
                $(".year" + year + " .collegeBox").append(box);
            }
        }
    }

    function is_touch_device() {
        return !!('ontouchstart' in window);
    }

});
